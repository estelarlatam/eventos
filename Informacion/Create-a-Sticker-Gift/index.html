<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Crear un Regalo de Sticker - Evento Especial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #ffd4c7 0%, #ffcfc4 50%, #ffd6cc 100%);
            min-height: 100vh;
            color: #333;
            padding-bottom: 2rem;
        }

        .countdown-banner {
            background: rgba(255, 255, 255, 0.9);
            text-align: center;
            padding: 0.75rem;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .countdown-time {
            font-weight: 700;
            color: #e74c3c;
        }

        .event-ended {
            color: #999;
            font-weight: 600;
        }

        .hero-banner {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            background: #ffd4c7;
        }

        .hero-banner img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Overlay cuando el evento ha finalizado */
        .event-ended-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .event-ended-overlay.active {
            display: flex;
        }

        .event-ended-text {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            padding: 1rem 2rem;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
        }

        .tabs-container {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 40px;
            z-index: 99;
            border-bottom: 1px solid rgba(255,255,255,0.5);
        }

        .tabs {
            display: flex;
            max-width: 800px;
            margin: 0 auto;
        }

        .tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            background: transparent;
            border: none;
            font-size: 1rem;
        }

        .tab.active {
            color: #333;
            border-bottom-color: #ff6b9d;
            background: rgba(255,255,255,0.8);
        }

        .tab:hover {
            background: rgba(255,255,255,0.4);
        }

        .content-wrapper {
            max-width: 800px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.6);
            overflow: hidden;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
            text-align: center;
        }

        .card-subtitle {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-text {
            color: #555;
            line-height: 1.6;
            font-size: 0.95rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .awards-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            margin-bottom: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .awards-header {
            background: linear-gradient(135deg, #7c7fd6 0%, #5a5fc7 100%);
            color: white;
            text-align: center;
            padding: 1.25rem;
        }

        .awards-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .awards-header .subtitle {
            font-size: 1.1rem;
            font-weight: 600;
            opacity: 0.95;
            margin-top: 0.25rem;
        }

        .awards-content {
            padding: 1.5rem;
        }

        /* VUELTO AL ESTADO ORIGINAL - Sin escalado */
        .gift-image-container {
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background: transparent;
            position: relative;
        }

        /* VUELTO AL ESTADO ORIGINAL - Sin transformaciones */
        .gift-image-container img {
            width: 100%;
            height: auto;
            display: block;
        }

        .gift-examples-real {
            width: 100%;
            max-width: 500px;
            margin: 1rem auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .gift-examples-real img {
            width: 100%;
            height: auto;
            display: block;
        }

        .disclaimer {
            font-size: 0.8rem;
            color: #888;
            text-align: center;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .info-table th {
            background: linear-gradient(135deg, #7c7fd6 0%, #5a5fc7 100%);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }

        .info-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
            color: #555;
        }

        .info-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .info-table tr:hover {
            background: #f0f0f0;
        }

        .schedule-item {
            margin-bottom: 1.5rem;
            padding-left: 1.5rem;
            position: relative;
        }

        .schedule-item::before {
            content: '‚óÜ';
            position: absolute;
            left: 0;
            color: #3498db;
            font-size: 0.8rem;
        }

        .schedule-title {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .schedule-date {
            color: #555;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .schedule-note {
            color: #888;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            font-style: italic;
        }

        .details-list {
            list-style: none;
            padding: 0;
        }

        .details-list li {
            padding: 0.5rem 0;
            padding-left: 1rem;
            position: relative;
            color: #555;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .details-list li::before {
            content: '-';
            position: absolute;
            left: 0;
            color: #999;
        }

        .section-header {
            font-weight: 700;
            color: #333;
            margin: 1.5rem 0 0.75rem 0;
            font-size: 0.95rem;
        }

        .link-text {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }

        .link-text:hover {
            text-decoration: underline;
        }

        .accordion-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 1rem;
        }

        .accordion-header {
            background: #fff;
            color: #e74c3c;
            padding: 1rem;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
            border-bottom: 1px solid #eee;
        }

        .accordion-item {
            border-bottom: 1px solid #eee;
        }

        .accordion-trigger {
            width: 100%;
            padding: 1rem 1.25rem;
            background: #f8f9fa;
            border: none;
            text-align: left;
            font-size: 0.95rem;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .accordion-trigger:hover {
            background: #e9ecef;
        }

        /* Icono de estrellas en acorde√≥n */
        .accordion-trigger::before {
            content: '';
            width: 16px;
            height: 16px;
            background-image: url('https://i.ibb.co/PkG1JK1/icono-de-eventos-de-estrellas.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin-right: 0.5rem;
            flex-shrink: 0;
        }

        .accordion-icon {
            transition: transform 0.3s;
            color: #999;
        }

        .accordion-item.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #fff;
        }

        .accordion-item.active .accordion-content {
            max-height: 500px;
        }

        .accordion-body {
            padding: 1rem 1.25rem;
            color: #555;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .rankings-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: #333;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .participant-count {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            color: #666;
            font-weight: 400;
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }

        .user-ranking-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-rank-position {
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
            min-width: 60px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            overflow: hidden;
            flex-shrink: 0;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .user-name a {
            color: #2c3e50;
            text-decoration: none;
        }

        .user-name a:hover {
            color: #7c7fd6;
            text-decoration: underline;
        }

        .verified-badge {
            color: #3498db;
            font-size: 0.9rem;
        }

        .user-score {
            color: #3498db;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .ranking-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .ranking-item:hover {
            background: #f8f9fa;
        }

        .rank-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .rank-1 { background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%); color: white; }
        .rank-2 { background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%); color: white; }
        .rank-3 { background: linear-gradient(135deg, #cd7f32 0%, #a0522d 100%); color: white; }
        .rank-other { background: #ecf0f1; color: #666; font-size: 0.8rem; }

        .rank-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
            flex-shrink: 0;
            overflow: hidden;
        }

        .rank-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rank-info {
            flex: 1;
            min-width: 0;
        }

        .rank-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .rank-name a {
            color: #2c3e50;
            text-decoration: none;
        }

        .rank-name a:hover {
            color: #7c7fd6;
            text-decoration: underline;
        }

        .rank-score {
            color: #3498db;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .form-label .required {
            color: #e74c3c;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #7c7fd6;
            box-shadow: 0 0 0 3px rgba(124, 127, 214, 0.1);
        }

        .form-input::placeholder {
            color: #aaa;
        }

        .form-hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.25rem;
        }

        .image-upload-container {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .image-upload-container:hover {
            border-color: #7c7fd6;
            background: #f0f0ff;
        }

        .image-upload-container.has-image {
            border-style: solid;
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .image-upload-input {
            display: none;
        }

        .image-upload-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 1rem;
            display: none;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .image-upload-preview.active {
            display: block;
        }

        .image-upload-text {
            color: #666;
            font-size: 0.9rem;
        }

        .image-upload-text .icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .image-upload-change {
            color: #7c7fd6;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: none;
        }

        .image-upload-container.has-image .image-upload-change {
            display: block;
        }

        .image-upload-container.has-image .image-upload-text {
            display: none;
        }

        .enter-button-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .btn-enter {
            background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
            color: white;
            border: none;
            padding: 1rem 4rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
            transition: all 0.3s;
            width: 100%;
            max-width: 400px;
        }

        .btn-enter:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.6);
        }

        .btn-enter:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: #ccc !important;
        }

        .btn-enter.entered {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        /* Estilo especial para cuando el evento ha finalizado */
        .btn-enter.event-ended-btn {
            background: #666 !important;
            cursor: not-allowed;
        }

        .btn-leave {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
            transition: all 0.3s;
        }

        .btn-leave:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 67, 54, 0.6);
        }

        .btn-leave:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 450px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlide 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        /* Botones de paginaci√≥n - Rect√°ngulos con esquinas totalmente redondeadas */
        .btn-modal {
            padding: 0.75rem 2rem;
            border-radius: 50px;
            border: 2px solid #e0e0e0;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            background: white;
            color: #666;
        }

        .btn-modal:hover:not(:disabled) {
            background: #f0f0f0;
            border-color: #ccc;
        }

        .btn-modal:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-cancel {
            background: #f0f0f0;
            color: #666;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            width: 100%;
        }

        .btn-cancel:hover {
            background: #e0e0e0;
        }

        .btn-ok {
            background: #2196f3;
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .btn-ok:hover {
            background: #1976d2;
        }

        .btn-ok-full {
            background: #2196f3;
            color: white;
            padding: 0.875rem 2rem;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            margin-top: 0.5rem;
        }

        .btn-ok-full:hover {
            background: #1976d2;
        }

        .btn-ok-full:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-spacer {
            height: 100px;
        }

        .alert {
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .alert-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }

        .alert-success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            font-family: monospace;
            font-size: 0.8rem;
            text-align: center;
        }

        .upload-error {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        /* Estilos espec√≠ficos para botones de paginaci√≥n */
        .pagination-btn {
            background: white;
            border: 2px solid #e0e0e0;
            color: #666;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f0f0f0;
            border-color: #ccc;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 640px) {
            .content-wrapper {
                padding: 1rem;
            }
            
            .tabs {
                font-size: 0.9rem;
            }

            .btn-enter, .btn-leave {
                padding: 0.875rem 1.5rem;
                font-size: 1rem;
            }

            .modal {
                padding: 1.5rem;
            }
            
            .user-rank-position {
                font-size: 1rem;
                min-width: 50px;
            }

            .pagination-btn {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
            }

            .event-ended-text {
                font-size: 1.5rem;
                padding: 0.75rem 1rem;
            }
        }
    </style>
<base target="_blank">
</head>
<body>

    <!-- Debug Info -->
    <div id="debugInfo" class="debug-info" style="display: none;"></div>

    <!-- Countdown Banner -->
    <div class="countdown-banner">
        Hasta el final del evento: <span class="countdown-time" id="countdown">Cargando...</span>
    </div>

    <!-- Hero Banner -->
    <div class="hero-banner" id="heroBanner">
        <img src="https://raw.githubusercontent.com/estelarlatam/eventos/refs/heads/main/Informacion/Create-a-Sticker-Gift/contenido-del-evento/%E2%96%A0Banner-del-Evento.png" 
             alt="Create a Sticker Gift Event Banner" 
             onerror="this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg, #ffb6c1 0%, #ffc0cb 100%)'; this.parentElement.innerHTML='<div style=\'padding: 2rem; text-align: center;\'><h1 style=\'color: white; font-size: 2rem;\'>Create a Sticker Gift!</h1></div>';">
        
        <!-- Overlay cuando el evento ha finalizado -->
        <div class="event-ended-overlay" id="eventEndedOverlay">
            <div class="event-ended-text">El evento ha finalizado</div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('details')">Detalles del evento</button>
            <button class="tab" onclick="switchTab('rankings')">Puntuaciones</button>
        </div>
    </div>

    <!-- Content -->
    <div class="content-wrapper">

        <!-- TAB: DETALLES -->
        <div id="details" class="tab-content active">
            
            <!-- Intro Card -->
            <div class="card">
                <p class="card-text">
                    <strong>Los ganadores de este evento obtendr√°n el privilegio exclusivo de dise√±ar un regalo.</strong>
                </p>
                <p class="card-text">
                    ¬°Estos regalos estar√°n disponibles para todos los usuarios en cualquier momento! Obt√©n una alta puntuaci√≥n, ¬°y todos podr√≠an regalar stickers con tu dise√±o original!
                </p>
            </div>

            <!-- Original Gift Image - VUELTO AL ESTADO ORIGINAL -->
            <div class="card">
                <div class="card-subtitle">IMAGEN DEL REGALO ORIGINAL</div>
                <div class="gift-image-container">
                    <img src="https://content-cf.reality.app/6ead3b317ae2a6f13dd5dbf9190fc02b6212c1b2.png?t=1681363059" 
                         alt="Imagen del regalo original" 
                         onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22><rect fill=%22%23ff6b9d%22 width=%22400%22 height=%22300%22/><text x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2220%22>Imagen del Regalo</text></svg>';">
                </div>
                <p class="disclaimer">*La imagen de arriba es una muestra. El dise√±o y distribuci√≥n real pueden diferir.</p>
            </div>

            <!-- Awards Section -->
            <div class="awards-section">
                <div class="awards-header">
                    <h3>Premios</h3>
                    <div class="subtitle">Streamer</div>
                </div>
                <div class="awards-content">
                    <table class="info-table">
                        <thead>
                            <tr>
                                <th>Condiciones</th>
                                <th>Premios</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Rank 1¬∞ - 3¬∞ y obtener una puntuaci√≥n de evento de 3,000,000 o superior</td>
                                <td>Oportunidad de crear un regalo original basado en una imagen proporcionada por el usuario.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Schedule -->
            <div class="card">
                <h3 class="card-title">Calendario</h3>
                
                <div class="schedule-item">
                    <div class="schedule-title">Per√≠odo de Inscripci√≥n</div>
                    <div class="schedule-date" id="fecha-inscripcion">Cargando...</div>
                    <div class="schedule-note">Nota: Las inscripciones al evento se aceptar√°n hasta el final del per√≠odo del evento.</div>
                </div>

                <div class="schedule-item">
                    <div class="schedule-title">Per√≠odo del Evento</div>
                    <div class="schedule-date" id="fecha-evento">Cargando...</div>
                </div>

                <div class="schedule-item">
                    <div class="schedule-title">Per√≠odo de Distribuci√≥n de Premios</div>
                    <div class="schedule-date">‚ñ†Regalo original: Se lanzar√° aproximadamente 3 meses despu√©s.</div>
                </div>
            </div>

            <!-- Award Details -->
            <div class="card">
                <h3 class="card-title">Detalles de los Premios</h3>
                
                <ul class="details-list">
                    <li>Solo los usuarios que mantengan su configuraci√≥n regional en Global durante todo el per√≠odo del evento son elegibles para recibir premios. Los usuarios que cambien de regi√≥n durante el evento no ser√°n elegibles.</li>
                </ul>

                <div class="section-header">‚ñ†Creaci√≥n de Regalo Original</div>
                <ul class="details-list">
                    <li>Creadores: Usuarios que ocupen del 1¬∞ al 3¬∞ lugar en este evento.</li>
                    <li>Estos usuarios ser√°n notificados antes del 10 de febrero de 2026 a las 23:59 -05 a trav√©s de la pantalla "Chat" en la App Estelar.</li>
                    <li>El nombre del regalo, la imagen base a utilizar y el nombre del creador deben enviarse antes del 22 de febrero de 2026 a las 09:59 -05.</li>
                    <li>A estos usuarios se les pedir√° que presenten un Certificado de transferencia de derechos de la ilustraci√≥n. El incumplimiento resultar√° en la cancelaci√≥n del premio.</li>
                </ul>

                <p style="font-size: 0.85rem; color: #888; margin: 1rem 0; font-style: italic;">
                    Nota: Los usuarios que no est√©n en el top 3 no ser√°n contactados. Gracias por su comprensi√≥n.
                </p>

                <ul class="details-list">
                    <li>Los regalos est√°n programados para lanzarse aproximadamente 3 meses despu√©s.</li>
                    <li>Estos regalos se lanzar√°n como regalos de Monedas.</li>
                    <li>Los regalos ser√°n animados como "GG", "Nos vemos" y "Buenas noches". No puedes designar otros tipos de animaci√≥n.</li>
                    <li>Si no puedes responder a las consultas sobre la creaci√≥n de premios dentro del per√≠odo establecido, tus privilegios de dise√±o de premios pueden ser revocados.</li>
                </ul>

                <div class="section-header">‚ñ†Im√°genes a Utilizar para los Regalos</div>
                
                <div class="gift-examples-real">
                    <img src="https://raw.githubusercontent.com/estelarlatam/eventos/refs/heads/main/Informacion/Create-a-Sticker-Gift/contenido-del-evento/%E2%96%A0Im%C3%A1genes%20para%20usar%20en%20regalos.png" 
                         alt="Im√°genes para usar en regalos" 
                         onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'padding: 2rem; text-align: center; background: #f0f0f0; border-radius: 12px;\'>üëã üåô</div>';">
                </div>

                <ul class="details-list">
                    <li>La imagen debe ser un archivo PNG de 512 x 512px con fondo transparente.</li>
                    <li>La imagen debe ser un archivo PNG de 512 x 512px con fondo transparente.</li>
                    <li>El borde blanco y la sombra ser√°n preparados por nuestro equipo de dise√±o.</li>
                    <li>No se permiten im√°genes que infrinjan derechos de autor, marcas registradas o que contengan contenido inapropiado.</li>
                    <li>La imagen debe ser original y creada por el usuario ganador.</li>
                </ul>

                <div class="section-header">‚ñ†Distribuci√≥n de Ganancias</div>
                <ul class="details-list">
                    <li>Los creadores recibir√°n un porcentaje de las ganancias cada vez que su regalo sea enviado.</li>
                    <li>El porcentaje exacto ser√° detallado en el contrato enviado a los ganadores.</li>
                    <li>Las ganancias se acumular√°n en la cuenta del creador y se podr√°n retirar mensualmente.</li>
                </ul>
            </div>

            <!-- FAQ Accordion -->
            <div class="accordion-container">
                <div class="accordion-header">Preguntas Frecuentes</div>
                
                <div class="accordion-item">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)">
                        ¬øQui√©n puede participar en este evento?
                        <span class="accordion-icon">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            Cualquier usuario con configuraci√≥n regional en Global puede participar. Los usuarios que cambien su regi√≥n durante el evento no ser√°n elegibles para premios.
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)">
                        ¬øC√≥mo se calcula la puntuaci√≥n del evento?
                        <span class="accordion-icon">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            La puntuaci√≥n se basa en la cantidad total de regalos recibidos durante el per√≠odo del evento. Solo los regalos enviados durante el evento cuentan para la puntuaci√≥n.
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)">
                        ¬øPuedo editar mi regalo despu√©s de enviarlo?
                        <span class="accordion-icon">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            Una vez aprobado el dise√±o del regalo, no se permiten cambios mayores. Correcciones menores pueden ser solicitadas dentro de las 48 horas posteriores a la aprobaci√≥n.
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)">
                        ¬øQu√© pasa si no respondo a tiempo?
                        <span class="accordion-icon">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            Si no respondes a las consultas sobre la creaci√≥n de premios dentro del per√≠odo establecido (antes del 22 de febrero), tus privilegios de dise√±o de premios pueden ser revocados y otorgados al siguiente participante en el ranking.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: RANKINGS -->
        <div id="rankings" class="tab-content">
            
            <!-- User Ranking Card -->
            <div class="user-ranking-card" id="userRanking" style="display: none;">
                <div class="user-rank-position" id="userRank">--</div>
                <div class="user-avatar" id="userAvatar">
                    <span id="userInitial">?</span>
                    <img id="userAvatarImg" style="display: none;" alt="Avatar">
                </div>
                <div class="user-info">
                    <div class="user-name">
                        <a href="#" id="userNameLink">Tu Nombre</a>
                        <span class="verified-badge" id="verifiedBadge" style="display: none;">‚úì</span>
                    </div>
                    <div class="user-score" id="userScore">0 puntos</div>
                </div>
            </div>

            <!-- Not Participating Message -->
            <div class="card" id="notParticipatingMsg" style="text-align: center; padding: 2rem;">
                <p style="color: #666; margin-bottom: 1rem;">A√∫n no participas en este evento</p>
                <p style="font-size: 0.9rem; color: #888;">√önete para aparecer en el ranking</p>
            </div>

            <!-- Rankings Header -->
            <div class="rankings-header">
                <span>üèÜ</span>
                <span>Clasificaci√≥n General</span>
                <span class="participant-count">
                    <span>üë•</span>
                    <span id="participantCount">0 participantes</span>
                </span>
            </div>

            <!-- Ranking List -->
            <div class="ranking-list" id="rankingList">
                <div class="ranking-item" style="justify-content: center; color: #888; padding: 2rem;">
                    Cargando clasificaci√≥n...
                </div>
            </div>

            <!-- Pagination -->
            <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap;">
                <button class="pagination-btn" onclick="changePage(-1)" id="prevBtn">‚Üê Anterior</button>
                <span id="pageIndicator" style="padding: 0.5rem 1rem; color: #666; font-weight: 600;">P√°gina 1</span>
                <button class="pagination-btn" onclick="changePage(1)" id="nextBtn">Siguiente ‚Üí</button>
            </div>
        </div>

        <div class="content-spacer"></div>
    </div>

    <!-- Fixed Button Container -->
    <div class="enter-button-container" id="buttonContainer">
        <button class="btn-enter" id="enterBtn" onclick="showEnterModal()">
            Participar en el Evento
        </button>
    </div>

    <!-- Enter Event Modal -->
    <div class="modal-overlay" id="enterModal">
        <div class="modal">
            <h3 class="modal-title">üéâ √önete al Evento</h3>
            
            <!-- Image Upload -->
            <div class="form-group" style="text-align: center;">
                <div class="image-upload-container" id="uploadContainer" onclick="document.getElementById('fileInput').click()">
                    <img class="image-upload-preview" id="uploadPreview" alt="Preview">
                    <div class="image-upload-text">
                        <span class="icon">üì∑</span>
                        Foto de Perfil <span style="color: #e74c3c;">*</span><br>
                        <small style="color: #999;">Toca para subir una foto</small>
                    </div>
                    <div class="image-upload-change">Cambiar imagen</div>
                </div>
                <input type="file" class="image-upload-input" id="fileInput" accept="image/jpeg,image/png,image/jpg" onchange="handleFileSelect(event)">
                <p class="form-hint">Formatos: JPG, PNG. M√°ximo 2MB (Obligatorio)</p>
                <div id="uploadError" class="upload-error" style="display: none;"></div>
            </div>

            <!-- Username -->
            <div class="form-group">
                <label class="form-label">Nombre de Usuario <span class="required">*</span></label>
                <input type="text" class="form-input" id="regUsername" placeholder="Tu nombre de usuario" required>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label class="form-label">Correo Electr√≥nico <span class="required">*</span></label>
                <input type="email" class="form-input" id="regEmail" placeholder="tu@email.com" required>
            </div>

            <!-- Profile Link -->
            <div class="form-group">
                <label class="form-label">Link del Perfil <span class="required">*</span></label>
                <input type="url" class="form-input" id="regProfileLink" placeholder="https://estelar.app/usuario" required>
                <p class="form-hint">URL completa de tu perfil en Estelar</p>
            </div>

            <div style="margin-top: 1.5rem;">
                <button class="btn-ok-full" onclick="confirmEnter()" id="confirmEnterBtn">
                    <span id="enterSpinner" class="spinner" style="display: none;"></span>
                    <span id="enterText">Confirmar Registro</span>
                </button>
                <button class="btn-cancel" onclick="closeModal('enterModal')" style="margin-top: 0.5rem;">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Leave Event Modal -->
    <div class="modal-overlay" id="leaveModal">
        <div class="modal">
            <h3 class="modal-title">‚ö†Ô∏è ¬øAbandonar el evento?</h3>
            <p style="color: #666; margin-bottom: 1.5rem; line-height: 1.5;">
                Si abandonas el evento, perder√°s toda tu puntuaci√≥n acumulada y no podr√°s recuperarla. ¬øEst√°s seguro?
            </p>
            <div class="modal-buttons">
                <button class="btn-modal" onclick="closeModal('leaveModal')">Cancelar</button>
                <button class="btn-ok" onclick="confirmLeave()" id="confirmLeaveBtn" style="background: #f44336;">
                    <span id="leaveSpinner" class="spinner" style="display: none;"></span>
                    <span id="leaveText">Abandonar</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div style="font-size: 3rem; margin-bottom: 1rem;">‚úÖ</div>
            <h3 class="modal-title" id="successTitle">¬°√âxito!</h3>
            <p style="color: #666; margin-bottom: 1.5rem;" id="successMessage">Operaci√≥n completada correctamente.</p>
            <button class="btn-ok-full" onclick="closeModal('successModal')">Aceptar</button>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal-overlay" id="errorModal">
        <div class="modal">
            <div style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</div>
            <h3 class="modal-title" id="errorTitle">Error</h3>
            <p style="color: #666; margin-bottom: 1.5rem;" id="errorMessage">Ha ocurrido un error.</p>
            <button class="btn-ok-full" onclick="closeModal('errorModal')" style="background: #f44336;">Aceptar</button>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURACI√ìN
        // ==========================================
        
        const CONFIG = {
            APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbysVo8dj-2ROE-OKTEoaYIPTjUnZ10yPj5xQsRjpaPvTDExz4_yZQJMiUHtcA1-DplBBw/exec',
            EVENT_NAME: 'Create-a-Sticker-Gift',
            IMGBB_API_KEY: 'd707728d8abb29813e79f898ec131fc5'
        };

        const EVENT_CONFIG = {
            registrationStart: new Date('2026-02-08T06:00:00'),
            registrationEnd: new Date('2026-02-15T23:59:59'),
            eventStart: new Date('2026-02-16T06:00:00'),
            eventEnd: new Date('2026-02-22T23:59:59')
        };

        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        
        let currentUser = null;
        let currentPage = 1;
        const itemsPerPage = 20;
        let uploadedImageBase64 = null;
        let isEventEnded = false;
        let isUserParticipating = false;
        let allParticipants = [];

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando aplicaci√≥n...');
            initializeDates();
            startCountdown();
            checkExistingParticipation();
            loadParticipants();
            
            setTimeout(function() {
                console.log('üîç Depuraci√≥n - Estado actual:', {
                    currentUser: currentUser,
                    isUserParticipating: isUserParticipating,
                    localStorage: localStorage.getItem('eventUser_' + CONFIG.EVENT_NAME)
                });
                
                if (currentUser && isUserParticipating) {
                    console.log('üîÑ Forzando actualizaci√≥n de UI...');
                    updateUIForParticipant();
                    renderRankings();
                }
            }, 1500);
        });

        // ==========================================
        // FUNCIONES DE FECHAS Y CONTEO
        // ==========================================
        
        function initializeDates() {
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit',
                timeZoneName: 'short'
            };
            
            const regStart = EVENT_CONFIG.registrationStart.toLocaleDateString('es-ES', options);
            const regEnd = EVENT_CONFIG.registrationEnd.toLocaleDateString('es-ES', options);
            const evtStart = EVENT_CONFIG.eventStart.toLocaleDateString('es-ES', options);
            const evtEnd = EVENT_CONFIG.eventEnd.toLocaleDateString('es-ES', options);
            
            document.getElementById('fecha-inscripcion').textContent = `${regStart} - ${regEnd}`;
            document.getElementById('fecha-evento').textContent = `${evtStart} - ${evtEnd}`;
        }

        function startCountdown() {
            function updateCountdown() {
                const now = new Date();
                const end = EVENT_CONFIG.eventEnd;
                const diff = end - now;
                
                if (diff <= 0) {
                    // Evento ha finalizado
                    isEventEnded = true;
                    document.getElementById('countdown').innerHTML = '<span class="event-ended">Evento Finalizado</span>';
                    
                    // Mostrar overlay en el banner
                    document.getElementById('eventEndedOverlay').classList.add('active');
                    
                    // Deshabilitar bot√≥n de participar completamente
                    const enterBtn = document.getElementById('enterBtn');
                    enterBtn.textContent = 'Evento Finalizado';
                    enterBtn.disabled = true;
                    enterBtn.classList.add('event-ended-btn');
                    enterBtn.onclick = null; // Eliminar el evento onclick
                    
                    // Ocultar mensaje de "A√∫n no participas" si no est√° participando
                    if (!isUserParticipating) {
                        const notParticipatingMsg = document.getElementById('notParticipatingMsg');
                        if (notParticipatingMsg) {
                            notParticipatingMsg.innerHTML = `
                                <p style="color: #666; margin-bottom: 1rem;">El evento ha finalizado</p>
                                <p style="font-size: 0.9rem; color: #888;">Las inscripciones est√°n cerradas</p>
                            `;
                        }
                    }
                    
                    return;
                }
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').textContent = 
                    `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        // ==========================================
        // NAVEGACI√ìN DE TABS
        // ==========================================
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'rankings') {
                renderRankings();
            }
        }

        // ==========================================
        // ACORDE√ìN FAQ
        // ==========================================
        
        function toggleAccordion(button) {
            const item = button.parentElement;
            const isActive = item.classList.contains('active');
            
            document.querySelectorAll('.accordion-item').forEach(acc => acc.classList.remove('active'));
            if (!isActive) item.classList.add('active');
        }

        // ==========================================
        // MANEJO DE IM√ÅGENES
        // ==========================================
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            const errorDiv = document.getElementById('uploadError');
            const preview = document.getElementById('uploadPreview');
            const container = document.getElementById('uploadContainer');
            
            errorDiv.style.display = 'none';
            
            if (!file) return;
            
            if (file.size > 2 * 1024 * 1024) {
                errorDiv.textContent = 'La imagen no debe superar los 2MB';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (!['image/jpeg', 'image/png', 'image/jpg'].includes(file.type)) {
                errorDiv.textContent = 'Solo se permiten archivos JPG o PNG';
                errorDiv.style.display = 'block';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImageBase64 = e.target.result;
                preview.src = e.target.result;
                preview.classList.add('active');
                container.classList.add('has-image');
            };
            reader.readAsDataURL(file);
        }

        // ==========================================
        // MODALES
        // ==========================================
        
        function showEnterModal() {
            // Verificar si el evento ha finalizado
            if (isEventEnded) {
                showError('El evento ha finalizado. Ya no se aceptan inscripciones.');
                return;
            }
            
            if (isUserParticipating) {
                showError('Ya est√°s participando en este evento');
                return;
            }
            
            document.getElementById('enterModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showSuccess(title, message) {
            document.getElementById('successTitle').textContent = title;
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').classList.add('active');
        }

        function showError(message, title = 'Error') {
            document.getElementById('errorTitle').textContent = title;
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').classList.add('active');
        }

        // ==========================================
        // CARGAR PARTICIPANTES
        // ==========================================
        
        function loadParticipants() {
            console.log('üì° Cargando participantes del backend...');
            
            const script = document.createElement('script');
            const callbackName = 'cb_' + Date.now();
            
            window[callbackName] = function(data) {
                console.log('üì• Datos recibidos del backend:', data);
                
                if (data.success && data.participants) {
                    allParticipants = data.participants;
                    console.log('‚úÖ Participantes cargados:', allParticipants.length);
                    
                    renderRankings();
                    
                    if (currentUser && isUserParticipating) {
                        updateUserCard();
                    }
                } else {
                    console.error('‚ùå Error en datos:', data.error);
                    document.getElementById('rankingList').innerHTML = 
                        `<div class="ranking-item" style="justify-content: center; color: #e74c3c; padding: 2rem;">
                            Error: ${data.error || 'No se pudieron cargar los participantes'}
                         </div>`;
                }
                
                delete window[callbackName];
                if (script.parentNode) document.head.removeChild(script);
            };
            
            script.src = `${CONFIG.APPS_SCRIPT_URL}?action=getParticipants&evento=${encodeURIComponent(CONFIG.EVENT_NAME)}&callback=${callbackName}&_=${Date.now()}`;
            script.onerror = function() {
                console.error('‚ùå Error de conexi√≥n al cargar participantes');
                document.getElementById('rankingList').innerHTML = 
                    '<div class="ranking-item" style="justify-content: center; color: #e74c3c; padding: 2rem;">Error de conexi√≥n</div>';
                delete window[callbackName];
            };
            
            document.head.appendChild(script);
        }

        // ==========================================
        // MANEJO DE ERRORES EN AVATARES
        // ==========================================
        
        function handleAvatarError(imgElement, initial) {
            console.log('üîÑ Reemplazando avatar por inicial:', initial);
            
            const avatarDiv = imgElement.parentElement;
            avatarDiv.innerHTML = initial;
            avatarDiv.style.display = 'flex';
            avatarDiv.style.alignItems = 'center';
            avatarDiv.style.justifyContent = 'center';
            avatarDiv.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            avatarDiv.style.color = 'white';
            avatarDiv.style.fontWeight = '600';
            avatarDiv.style.fontSize = '1.2rem';
            
            console.log('‚ùå Imagen que fall√≥:', imgElement.src);
        }

        // ==========================================
        // RENDERIZAR RANKINGS
        // ==========================================

        function renderRankings() {
            const list = document.getElementById('rankingList');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            let combinedParticipants = [...allParticipants];
            
            if (currentUser && isUserParticipating) {
                const userExists = combinedParticipants.some(p => 
                    p.email === currentUser.email || 
                    p.username === currentUser.username ||
                    (currentUser.profileLink && p.profileLink === currentUser.profileLink)
                );
                
                if (!userExists) {
                    combinedParticipants.push({
                        username: currentUser.username,
                        email: currentUser.email,
                        profileLink: currentUser.profileLink,
                        profileImage: currentUser.profileImage || currentUser.avatarUrl || currentUser.profile_image,
                        score: currentUser.score || 0
                    });
                    console.log('‚ûï Usuario actual agregado a rankings:', currentUser.username);
                }
            }
            
            if (combinedParticipants.length === 0) {
                list.innerHTML = '<div class="ranking-item" style="justify-content: center; color: #888; padding: 2rem;">No hay participantes a√∫n</div>';
                document.getElementById('participantCount').textContent = '0 participantes';
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                return;
            }
            
            combinedParticipants.sort((a, b) => (b.score || 0) - (a.score || 0));
            
            const totalPages = Math.ceil(combinedParticipants.length / itemsPerPage);
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = combinedParticipants.slice(start, end);
            
            list.innerHTML = '';
            
            pageData.forEach((user, index) => {
                const rank = start + index + 1;
                const item = document.createElement('div');
                item.className = 'ranking-item';
                
                let rankClass = 'rank-other';
                if (rank === 1) rankClass = 'rank-1';
                else if (rank === 2) rankClass = 'rank-2';
                else if (rank === 3) rankClass = 'rank-3';
                
                const imageUrl = user.profileImage || user.avatarUrl || user.profile_image || '';
                const hasImage = imageUrl && imageUrl.trim() !== '' && !imageUrl.includes('undefined');
                
                console.log(`üë§ ${user.username} - Rank ${rank}:`, {
                    hasImage: hasImage ? 'S√ç' : 'NO',
                    imageUrl: imageUrl.substring(0, 50)
                });
                
                let avatarContent;
                if (hasImage) {
                    avatarContent = `<img src="${imageUrl}" alt="${user.username}" 
                        class="avatar-img"
                        onerror="handleAvatarError(this, '${user.username.charAt(0).toUpperCase()}')">`;
                } else {
                    avatarContent = user.username.charAt(0).toUpperCase();
                }
                
                item.innerHTML = `
                    <div class="rank-number ${rankClass}">${rank}</div>
                    <div class="rank-avatar">${avatarContent}</div>
                    <div class="rank-info">
                        <div class="rank-name">
                            <a href="${user.profileLink || '#'}" target="_blank">${escapeHtml(user.username)}</a>
                        </div>
                    </div>
                    <div class="rank-score">${formatNumber(user.score || 0)} pts</div>
                `;
                
                list.appendChild(item);
            });
            
            document.getElementById('pageIndicator').textContent = `P√°gina ${currentPage} de ${totalPages}`;
            document.getElementById('participantCount').textContent = `${combinedParticipants.length} participantes`;
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
            
            console.log('üìä Rankings renderizados:', {
                totalParticipants: combinedParticipants.length,
                currentUserIncluded: currentUser ? 'S√ç' : 'NO'
            });
        }

        function changePage(direction) {
            const totalPages = Math.ceil(allParticipants.length / itemsPerPage);
            const newPage = currentPage + direction;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderRankings();
            }
        }

        // ==========================================
        // PARTICIPACI√ìN EN EL EVENTO
        // ==========================================
        
        function checkExistingParticipation() {
            const savedUser = localStorage.getItem('eventUser_' + CONFIG.EVENT_NAME);
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    isUserParticipating = true;
                    console.log('‚úÖ Usuario encontrado en localStorage:', currentUser.username);
                    updateUIForParticipant();
                } catch (error) {
                    console.error('‚ùå Error al parsear usuario:', error);
                }
            }
        }

        function updateUIForParticipant() {
            const btn = document.getElementById('enterBtn');
            
            // Si el evento ha finalizado, no mostrar el bot√≥n de "Ya est√°s participando"
            if (isEventEnded) {
                btn.textContent = 'Evento Finalizado';
                btn.disabled = true;
                btn.classList.add('event-ended-btn');
                btn.onclick = null;
                return;
            }
            
            btn.textContent = 'Ya est√°s participando ‚úì';
            btn.classList.add('entered');
            btn.disabled = true;
            
            const container = document.getElementById('buttonContainer');
            if (!document.getElementById('leaveBtn')) {
                const leaveBtn = document.createElement('button');
                leaveBtn.id = 'leaveBtn';
                leaveBtn.className = 'btn-leave';
                leaveBtn.textContent = 'Abandonar';
                leaveBtn.onclick = () => document.getElementById('leaveModal').classList.add('active');
                container.appendChild(leaveBtn);
            }
            
            document.getElementById('notParticipatingMsg').style.display = 'none';
            document.getElementById('userRanking').style.display = 'flex';
            updateUserCard();
        }

        function updateUserCard() {
            if (!currentUser) return;
            
            let position = '--';
            try {
                const sorted = [...allParticipants].sort((a, b) => (b.score || 0) - (a.score || 0));
                const userIndex = sorted.findIndex(p => 
                    p.email === currentUser.email || 
                    p.username === currentUser.username ||
                    (currentUser.profileLink && p.profileLink === currentUser.profileLink)
                );
                if (userIndex !== -1) {
                    position = `#${userIndex + 1}`;
                }
            } catch (error) {
                console.log('‚ö†Ô∏è No se pudo calcular posici√≥n:', error);
            }
            
            document.getElementById('userRank').textContent = position;
            document.getElementById('userNameLink').textContent = currentUser.username;
            document.getElementById('userNameLink').href = currentUser.profileLink || '#';
            document.getElementById('userScore').textContent = `${formatNumber(currentUser.score || 0)} puntos`;
            
            const img = document.getElementById('userAvatarImg');
            const initial = document.getElementById('userInitial');
            
            const imageUrl = currentUser.profileImage || currentUser.avatarUrl || currentUser.profile_image || '';
            
            console.log('üñºÔ∏è updateUserCard - URL de imagen:', imageUrl);
            
            if (imageUrl && imageUrl.trim() !== '' && !imageUrl.includes('undefined')) {
                img.src = imageUrl;
                img.style.display = 'block';
                initial.style.display = 'none';
                
                img.onload = function() {
                    console.log('‚úÖ Foto cargada exitosamente en userAvatarImg:', imageUrl);
                };
                img.onerror = function() {
                    console.log('‚ùå Error cargando foto, usando inicial');
                    img.style.display = 'none';
                    initial.style.display = 'block';
                    initial.textContent = currentUser.username.charAt(0).toUpperCase();
                    
                    const avatarDiv = document.getElementById('userAvatar');
                    avatarDiv.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    avatarDiv.style.color = 'white';
                    avatarDiv.style.display = 'flex';
                    avatarDiv.style.alignItems = 'center';
                    avatarDiv.style.justifyContent = 'center';
                    avatarDiv.style.fontWeight = '700';
                    avatarDiv.style.fontSize = '1.5rem';
                };
            } else {
                console.log('‚ö†Ô∏è No hay imagen v√°lida, usando inicial');
                img.style.display = 'none';
                initial.style.display = 'block';
                initial.textContent = currentUser.username.charAt(0).toUpperCase();
            }
        }

        // ==========================================
        // REGISTRO CON IMGBB
        // ==========================================
        
        async function confirmEnter() {
            // Verificar nuevamente si el evento ha finalizado
            if (isEventEnded) {
                showError('El evento ha finalizado. Ya no se aceptan inscripciones.');
                return;
            }
            
            const username = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const profileLink = document.getElementById('regProfileLink').value.trim();
            
            if (!uploadedImageBase64) {
                showError('Debes subir una foto de perfil');
                return;
            }
            if (!username || !email || !profileLink) {
                showError('Todos los campos son obligatorios');
                return;
            }
            if (!email.includes('@')) {
                showError('Ingresa un correo v√°lido');
                return;
            }
            
            const btn = document.getElementById('confirmEnterBtn');
            const spinner = document.getElementById('enterSpinner');
            const text = document.getElementById('enterText');
            
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            text.textContent = 'Subiendo imagen...';
            
            try {
                const imageUrl = await uploadToImgBB(uploadedImageBase64);
                text.textContent = 'Registrando...';
                
                const response = await fetch(CONFIG.APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'text/plain;charset=utf-8'},
                    body: JSON.stringify({
                        action: 'join',
                        username: username,
                        email: email,
                        profileLink: profileLink,
                        profileImage: imageUrl,
                        evento: CONFIG.EVENT_NAME
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUser = {
                        username,
                        email,
                        profileLink,
                        profileImage: imageUrl,
                        score: 0
                    };
                    
                    localStorage.setItem('eventUser_' + CONFIG.EVENT_NAME, JSON.stringify(currentUser));
                    isUserParticipating = true;
                    
                    closeModal('enterModal');
                    showSuccess('¬°Bienvenido!', 'Te has registrado exitosamente en el evento');
                    
                    updateUIForParticipant();
                    loadParticipants();
                    
                    document.getElementById('regUsername').value = '';
                    document.getElementById('regEmail').value = '';
                    document.getElementById('regProfileLink').value = '';
                    document.getElementById('uploadPreview').classList.remove('active');
                    document.getElementById('uploadContainer').classList.remove('has-image');
                    uploadedImageBase64 = null;
                } else {
                    throw new Error(result.error || 'Error al registrar');
                }
            } catch (error) {
                showError(error.message || 'Error de conexi√≥n. Intenta de nuevo.');
            } finally {
                btn.disabled = false;
                spinner.style.display = 'none';
                text.textContent = 'Confirmar Registro';
            }
        }

        async function uploadToImgBB(base64Image) {
            const base64Data = base64Image.split(',')[1];
            const formData = new FormData();
            formData.append('image', base64Data);
            
            const response = await fetch(`https://api.imgbb.com/1/upload?key=${CONFIG.IMGBB_API_KEY}`, {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            if (data.success) {
                return data.data.url;
            } else {
                throw new Error('Error al subir la imagen a ImgBB');
            }
        }

        // ==========================================
        // ABANDONAR EVENTO
        // ==========================================
        
        async function confirmLeave() {
            const btn = document.getElementById('confirmLeaveBtn');
            const spinner = document.getElementById('leaveSpinner');
            const text = document.getElementById('leaveText');
            
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            text.textContent = 'Procesando...';
            
            try {
                const response = await fetch(CONFIG.APPS_SCRIPT_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'text/plain;charset=utf-8'},
                    body: JSON.stringify({
                        action: 'leave',
                        email: currentUser.email,
                        evento: CONFIG.EVENT_NAME
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    localStorage.removeItem('eventUser_' + CONFIG.EVENT_NAME);
                    currentUser = null;
                    isUserParticipating = false;
                    
                    const enterBtn = document.getElementById('enterBtn');
                    
                    // Si el evento ha finalizado, mantener el mensaje de finalizado
                    if (isEventEnded) {
                        enterBtn.textContent = 'Evento Finalizado';
                        enterBtn.classList.add('event-ended-btn');
                        enterBtn.disabled = true;
                        enterBtn.onclick = null;
                    } else {
                        enterBtn.textContent = 'Participar en el Evento';
                        enterBtn.classList.remove('entered');
                        enterBtn.disabled = false;
                    }
                    
                    const leaveBtn = document.getElementById('leaveBtn');
                    if (leaveBtn) leaveBtn.remove();
                    
                    document.getElementById('userRanking').style.display = 'none';
                    document.getElementById('notParticipatingMsg').style.display = 'block';
                    
                    closeModal('leaveModal');
                    showSuccess('Evento abandonado', 'Has salido del evento correctamente');
                    loadParticipants();
                } else {
                    throw new Error(result.error || 'Error al abandonar');
                }
            } catch (error) {
                showError(error.message || 'Error de conexi√≥n');
            } finally {
                btn.disabled = false;
                spinner.style.display = 'none';
                text.textContent = 'Abandonar';
            }
        }

        // ==========================================
        // UTILIDADES
        // ==========================================
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // Cerrar modales al hacer clic fuera
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) this.classList.remove('active');
            });
        });
        
        function debugCurrentState() {
            console.log('üîç DEBUG - Estado actual:', {
                currentUser: currentUser,
                isUserParticipating: isUserParticipating,
                isEventEnded: isEventEnded,
                localStorage: localStorage.getItem('eventUser_' + CONFIG.EVENT_NAME),
                allParticipantsCount: allParticipants.length,
                userPhoto: currentUser ? (currentUser.profileImage || 'No tiene foto') : 'No hay usuario'
            });
            
            if (currentUser) {
                console.log('üì∏ URL de foto del usuario:', currentUser.profileImage);
                console.log('üë§ Nombre del usuario:', currentUser.username);
            }
        }
        
        window.debugEvent = debugCurrentState;
    </script>
</body>
</html>

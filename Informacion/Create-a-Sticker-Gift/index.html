<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear un Regalo de Sticker - Evento Especial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #ffd4c7 0%, #ffcfc4 50%, #ffd6cc 100%);
            min-height: 100vh;
            color: #333;
            padding-bottom: 2rem;
        }

        /* Countdown Banner */
        .countdown-banner {
            background: rgba(255, 255, 255, 0.9);
            text-align: center;
            padding: 0.75rem;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .countdown-time {
            font-weight: 700;
            color: #e74c3c;
        }

        .event-ended {
            color: #999;
            font-weight: 600;
        }

        /* Hero Banner */
        .hero-banner {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            background: #ffd4c7;
        }

        .hero-banner img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Tabs Navigation */
        .tabs-container {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 40px;
            z-index: 99;
            border-bottom: 1px solid rgba(255,255,255,0.5);
        }

        .tabs {
            display: flex;
            max-width: 800px;
            margin: 0 auto;
        }

        .tab {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            background: transparent;
            border: none;
            font-size: 1rem;
        }

        .tab.active {
            color: #333;
            border-bottom-color: #ff6b9d;
            background: rgba(255,255,255,0.8);
        }

        .tab:hover {
            background: rgba(255,255,255,0.4);
        }

        /* Content Container */
        .content-wrapper {
            max-width: 800px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.6);
            overflow: hidden;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
            text-align: center;
        }

        .card-subtitle {
            font-size: 0.9rem;
            color: #666;
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-text {
            color: #555;
            line-height: 1.6;
            font-size: 0.95rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        /* Awards Section */
        .awards-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            margin-bottom: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .awards-header {
            background: linear-gradient(135deg, #7c7fd6 0%, #5a5fc7 100%);
            color: white;
            text-align: center;
            padding: 1.25rem;
        }

        .awards-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .awards-header .subtitle {
            font-size: 1.1rem;
            font-weight: 600;
            opacity: 0.95;
            margin-top: 0.25rem;
        }

        .awards-content {
            padding: 1.5rem;
        }

        /* Gift Image Container */
        .gift-image-container {
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .gift-image-container img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Gift Examples */
        .gift-examples-real {
            width: 100%;
            max-width: 300px;
            margin: 1rem auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .gift-examples-real img {
            width: 100%;
            height: auto;
            display: block;
        }

        .disclaimer {
            font-size: 0.8rem;
            color: #888;
            text-align: center;
            margin-top: 0.5rem;
            font-style: italic;
        }

        /* Tables */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .info-table th {
            background: linear-gradient(135deg, #7c7fd6 0%, #5a5fc7 100%);
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }

        .info-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
            color: #555;
        }

        .info-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .info-table tr:hover {
            background: #f0f0f0;
        }

        /* Schedule Section */
        .schedule-item {
            margin-bottom: 1.5rem;
            padding-left: 1.5rem;
            position: relative;
        }

        .schedule-item::before {
            content: '‚óÜ';
            position: absolute;
            left: 0;
            color: #3498db;
            font-size: 0.8rem;
        }

        .schedule-title {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .schedule-date {
            color: #555;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .schedule-note {
            color: #888;
            font-size: 0.85rem;
            margin-top: 0.25rem;
            font-style: italic;
        }

        /* Award Details List */
        .details-list {
            list-style: none;
            padding: 0;
        }

        .details-list li {
            padding: 0.5rem 0;
            padding-left: 1rem;
            position: relative;
            color: #555;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .details-list li::before {
            content: '-';
            position: absolute;
            left: 0;
            color: #999;
        }

        .section-header {
            font-weight: 700;
            color: #333;
            margin: 1.5rem 0 0.75rem 0;
            font-size: 0.95rem;
        }

        .link-text {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
        }

        .link-text:hover {
            text-decoration: underline;
        }

        /* Accordion */
        .accordion-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-bottom: 1rem;
        }

        .accordion-header {
            background: #fff;
            color: #e74c3c;
            padding: 1rem;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
            border-bottom: 1px solid #eee;
        }

        .accordion-item {
            border-bottom: 1px solid #eee;
        }

        .accordion-trigger {
            width: 100%;
            padding: 1rem 1.25rem;
            background: #f8f9fa;
            border: none;
            text-align: left;
            font-size: 0.95rem;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .accordion-trigger:hover {
            background: #e9ecef;
        }

        .accordion-trigger::before {
            content: '‚óá';
            color: #3498db;
            margin-right: 0.5rem;
        }

        .accordion-icon {
            transition: transform 0.3s;
            color: #999;
        }

        .accordion-item.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #fff;
        }

        .accordion-item.active .accordion-content {
            max-height: 500px;
        }

        .accordion-body {
            padding: 1rem 1.25rem;
            color: #555;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Rankings Header */
        .rankings-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: #333;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .participant-count {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            color: #666;
            font-weight: 400;
            font-size: 0.9rem;
            margin-left: 0.5rem;
        }

        /* User Ranking Card */
        .user-ranking-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-rank-position {
            font-size: 1.25rem;
            font-weight: 700;
            color: #333;
            min-width: 50px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            overflow: hidden;
            flex-shrink: 0;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .user-name a {
            color: #2c3e50;
            text-decoration: none;
        }

        .user-name a:hover {
            color: #7c7fd6;
            text-decoration: underline;
        }

        .verified-badge {
            color: #3498db;
            font-size: 0.9rem;
        }

        .user-score {
            color: #3498db;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .ranking-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .ranking-item:hover {
            background: #f8f9fa;
        }

        .rank-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .rank-1 { background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%); color: white; }
        .rank-2 { background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%); color: white; }
        .rank-3 { background: linear-gradient(135deg, #cd7f32 0%, #a0522d 100%); color: white; }
        .rank-other { background: #ecf0f1; color: #666; font-size: 0.8rem; }

        .rank-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
            flex-shrink: 0;
            overflow: hidden;
        }

        .rank-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rank-info {
            flex: 1;
            min-width: 0;
        }

        .rank-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .rank-name a {
            color: #2c3e50;
            text-decoration: none;
        }

        .rank-name a:hover {
            color: #7c7fd6;
            text-decoration: underline;
        }

        .rank-score {
            color: #3498db;
            font-weight: 700;
            font-size: 0.9rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: #7c7fd6;
            box-shadow: 0 0 0 3px rgba(124, 127, 214, 0.1);
        }

        .form-input::placeholder {
            color: #aaa;
        }

        .form-hint {
            font-size: 0.8rem;
            color: #888;
            margin-top: 0.25rem;
        }

        /* Image Upload Styles */
        .image-upload-container {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .image-upload-container:hover {
            border-color: #7c7fd6;
            background: #f0f0ff;
        }

        .image-upload-container.has-image {
            border-style: solid;
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .image-upload-input {
            display: none;
        }

        .image-upload-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 1rem;
            display: none;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .image-upload-preview.active {
            display: block;
        }

        .image-upload-text {
            color: #666;
            font-size: 0.9rem;
        }

        .image-upload-text .icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .image-upload-change {
            color: #7c7fd6;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            display: none;
        }

        .image-upload-container.has-image .image-upload-change {
            display: block;
        }

        .image-upload-container.has-image .image-upload-text {
            display: none;
        }

        /* Button States */
        .enter-button-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .btn-enter {
            background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);
            color: white;
            border: none;
            padding: 1rem 4rem;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(233, 30, 99, 0.4);
            transition: all 0.3s;
            width: 100%;
            max-width: 400px;
        }

        .btn-enter:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(233, 30, 99, 0.6);
        }

        .btn-enter:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-enter.entered {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        .btn-leave {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
            transition: all 0.3s;
        }

        .btn-leave:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 67, 54, 0.6);
        }

        .btn-leave:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Modales */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlide 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-title {
            font-size: 1.25rem;
            color: #333;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .btn-modal {
            padding: 0.75rem 2rem;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .btn-cancel {
            background: #f0f0f0;
            color: #666;
        }

        .btn-cancel:hover {
            background: #e0e0e0;
        }

        .btn-ok {
            background: #2196f3;
            color: white;
        }

        .btn-ok:hover {
            background: #1976d2;
        }

        .btn-ok-full {
            background: #2196f3;
            color: white;
            padding: 0.75rem 3rem;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95rem;
            width: 100%;
        }

        .btn-ok-full:hover {
            background: #1976d2;
        }

        .btn-ok-full:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Espacio para el bot√≥n fijo */
        .content-spacer {
            height: 100px;
        }

        /* Alert Messages */
        .alert {
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .alert-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }

        .alert-success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .content-wrapper {
                padding: 1rem;
            }
            
            .tabs {
                font-size: 0.9rem;
            }

            .btn-enter, .btn-leave {
                padding: 0.875rem 1.5rem;
                font-size: 1rem;
            }

            .modal {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>

    <!-- Countdown Banner -->
    <div class="countdown-banner">
        Hasta el final del evento: <span class="countdown-time" id="countdown">Cargando...</span>
    </div>

    <!-- Hero Banner -->
    <div class="hero-banner">
        <img src="https://raw.githubusercontent.com/estelarlatam/eventos/refs/heads/main/Informacion/Create-a-Sticker-Gift/contenido-del-evento/%E2%96%A0Banner-del-Evento.png" 
             alt="Create a Sticker Gift Event Banner" 
             onerror="this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg, #ffb6c1 0%, #ffc0cb 100%)'; this.parentElement.innerHTML='<div style=\'padding: 2rem; text-align: center;\'><h1 style=\'color: white; font-size: 2rem;\'>Create a Sticker Gift!</h1></div>';">
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('details')">Detalles del evento</button>
            <button class="tab" onclick="switchTab('rankings')">Puntuaciones</button>
        </div>
    </div>

    <!-- Content -->
    <div class="content-wrapper">

        <!-- TAB: DETALLES -->
        <div id="details" class="tab-content active">
            
            <!-- Intro Card -->
            <div class="card">
                <p class="card-text">
                    <strong>Los ganadores de este evento obtendr√°n el privilegio exclusivo de dise√±ar un regalo.</strong>
                </p>
                <p class="card-text">
                    ¬°Estos regalos estar√°n disponibles para todos los usuarios en cualquier momento! Obt√©n una alta puntuaci√≥n, ¬°y todos podr√≠an regalar stickers con tu dise√±o original!
                </p>
            </div>

            <!-- Original Gift Image -->
            <div class="card">
                <div class="card-subtitle">IMAGEN DEL REGALO ORIGINAL</div>
                <div class="gift-image-container">
                    <img src="https://content-cf.reality.app/6ead3b317ae2a6f13dd5dbf9190fc02b6212c1b2.png?t=1681363059" 
                         alt="Imagen del regalo original" 
                         onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22><rect fill=%22%23ff6b9d%22 width=%22400%22 height=%22300%22/><text x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2220%22>Imagen del Regalo</text></svg>';">
                </div>
                <p class="disclaimer">*La imagen de arriba es una muestra. El dise√±o y distribuci√≥n real pueden diferir.</p>
            </div>

            <!-- Awards Section -->
            <div class="awards-section">
                <div class="awards-header">
                    <h3>Premios</h3>
                    <div class="subtitle">Streamer</div>
                </div>
                <div class="awards-content">
                    <table class="info-table">
                        <thead>
                            <tr>
                                <th>Condiciones</th>
                                <th>Premios</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Rank 1¬∞ - 3¬∞ y obtener una puntuaci√≥n de evento de 3,000,000 o superior</td>
                                <td>Oportunidad de crear un regalo original basado en una imagen proporcionada por el usuario.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Schedule -->
            <div class="card">
                <h3 class="card-title">Calendario</h3>
                
                <div class="schedule-item">
                    <div class="schedule-title">Per√≠odo de Inscripci√≥n</div>
                    <div class="schedule-date" id="fecha-inscripcion">Cargando...</div>
                    <div class="schedule-note">Nota: Las inscripciones al evento se aceptar√°n hasta el final del per√≠odo del evento.</div>
                </div>

                <div class="schedule-item">
                    <div class="schedule-title">Per√≠odo del Evento</div>
                    <div class="schedule-date" id="fecha-evento">Cargando...</div>
                </div>

                <div class="schedule-item">
                    <div class="schedule-title">Per√≠odo de Distribuci√≥n de Premios</div>
                    <div class="schedule-date">‚ñ†Regalo original: Se lanzar√° aproximadamente 3 meses despu√©s.</div>
                </div>
            </div>

            <!-- Award Details -->
            <div class="card">
                <h3 class="card-title">Detalles de los Premios</h3>
                
                <ul class="details-list">
                    <li>Solo los usuarios que mantengan su configuraci√≥n regional en Global durante todo el per√≠odo del evento son elegibles para recibir premios. Los usuarios que cambien de regi√≥n durante el evento no ser√°n elegibles.</li>
                </ul>

                <div class="section-header">‚ñ†Creaci√≥n de Regalo Original</div>
                <ul class="details-list">
                    <li>Creadores: Usuarios que ocupen del 1¬∞ al 3¬∞ lugar en este evento.</li>
                    <li>Estos usuarios ser√°n notificados antes del 10 de febrero de 2026 a las 23:59 -05 a trav√©s de la pantalla "Chat" en la App Estelar.</li>
                    <li>El nombre del regalo, la imagen base a utilizar y el nombre del creador deben enviarse antes del 22 de febrero de 2026 a las 09:59 -05.</li>
                    <li>A estos usuarios se les pedir√° que presenten un Certificado de transferencia de derechos de la ilustraci√≥n. El incumplimiento resultar√° en la cancelaci√≥n del premio.</li>
                </ul>

                <p style="font-size: 0.85rem; color: #888; margin: 1rem 0; font-style: italic;">
                    Nota: Los usuarios que no est√©n en el top 3 no ser√°n contactados. Gracias por su comprensi√≥n.
                </p>

                <ul class="details-list">
                    <li>Los regalos est√°n programados para lanzarse aproximadamente 3 meses despu√©s.</li>
                    <li>Estos regalos se lanzar√°n como regalos de Monedas.</li>
                    <li>Los regalos ser√°n animados como "GG", "Nos vemos" y "Buenas noches". No puedes designar otros tipos de animaci√≥n.</li>
                    <li>Si no puedes responder a las consultas sobre la creaci√≥n de premios dentro del per√≠odo establecido, tus privilegios de dise√±o de premios pueden ser revocados.</li>
                </ul>

                <div class="section-header">‚ñ†Im√°genes a Utilizar para los Regalos</div>
                
                <div class="gift-examples-real">
                    <img src="https://raw.githubusercontent.com/estelarlatam/eventos/refs/heads/main/Informacion/Create-a-Sticker-Gift/contenido-del-evento/%E2%96%A0Im%C3%A1genes%20para%20usar%20en%20regalos.png" 
                         alt="Im√°genes para usar en regalos" 
                         onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'padding: 2rem; text-align: center; background: #f0f0f0; border-radius: 12px;\'>üëã üåô</div>';">
                </div>

                <ul class="details-list">
                    <li>La imagen debe ser un archivo PNG de 512 x 512px con fondo transparente.</li>
                    <li>El borde blanco y la sombra ser√°n preparados por nuestro equipo.</li>
                    <li><a href="#" class="link-text">Haz clic aqu√≠</a> para ver creaciones de regalos anteriores.</li>
                </ul>
            </div>

            <!-- About Event Score -->
            <div class="card">
                <h3 class="card-title">Sobre la Puntuaci√≥n y Clasificaci√≥n del Evento</h3>
                
                <p style="margin-bottom: 1rem; color: #555;">La puntuaci√≥n del evento se calcula mediante el siguiente m√©todo:</p>
                
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center; font-weight: 700; color: #333; margin-bottom: 1rem;">
                    (Valor total en monedas de los regalos de los espectadores) x 10
                </div>

                <div class="section-header">Notas:</div>
                <ul class="details-list">
                    <li>Solo se cuentan las puntuaciones del evento registradas durante este evento.</li>
                    <li>Los art√≠culos recibidos antes de que entres al evento no contar√°n para tu puntuaci√≥n del evento, independientemente de cu√°ndo se recibieron.</li>
                    <li>Si dos o m√°s usuarios tienen la misma puntuaci√≥n de evento, su clasificaci√≥n se determina en el siguiente orden:</li>
                </ul>

                <div style="padding-left: 1rem; margin: 0.5rem 0; color: #555; font-size: 0.9rem;">
                    <p style="margin-bottom: 0.5rem;">(1) Si la puntuaci√≥n del evento es la misma, el usuario con m√°s seguidores al final del evento tendr√° una clasificaci√≥n m√°s alta.</p>
                    <p>(2) Si el n√∫mero de seguidores es el mismo, el usuario que entr√≥ al evento primero tendr√° una clasificaci√≥n m√°s alta.</p>
                </div>

                <p style="font-size: 0.85rem; color: #888; margin-top: 1rem; font-style: italic;">
                    *En caso de que el usuario cambie el evento participante, se considerar√° la √∫ltima fecha y hora de cambio como el momento de entrada.
                </p>
            </div>

            <!-- Important Notes Accordion -->
            <div class="accordion-container">
                <div class="accordion-header">
                    Por favor lee: Notas importantes sobre este evento
                </div>
                
                <div class="accordion-item active">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)">
                        <span>Resumen del Evento</span>
                        <span class="accordion-icon">‚ñº</span>
                    </button>
                    <div class="accordion-content" style="max-height: 500px;">
                        <div class="accordion-body">
                            Los participantes del evento ser√°n puntuados seg√∫n los regalos de los espectadores que reciban durante el evento. ¬°Los participantes pueden ganar bonificaciones seg√∫n su puntuaci√≥n del evento! Solo los usuarios que toquen el bot√≥n "Entrar" o "Pre-inscribirse" en la p√°gina del evento pueden unirse al evento.<br><br>
                            Los usuarios que no se inscriban no ser√°n elegibles para recibir puntos por la puntuaci√≥n del evento.<br><br>
                            Solo los usuarios que hayan transmitido durante 15 minutos o m√°s cada d√≠a durante 7 o m√°s d√≠as pueden entrar.
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)">
                        <span>Manejo de Informaci√≥n Personal</span>
                        <span class="accordion-icon">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            La informaci√≥n personal recopilada durante este evento se utilizar√° √∫nicamente para fines de verificaci√≥n de identidad y env√≠o de premios. No compartiremos tus datos con terceros sin tu consentimiento expreso.
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)">
                        <span>C√≥mo Entrar</span>
                        <span class="accordion-icon">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            Para participar en el evento, toca el bot√≥n "Entrar" en la parte inferior de esta p√°gina. Aseg√∫rate de cumplir con todos los requisitos de elegibilidad antes de inscribirte.
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)">
                        <span>Requisitos de Entrada</span>
                        <span class="accordion-icon">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            - Tener la regi√≥n configurada en Global<br>
                            - Haber transmitido al menos 15 minutos por d√≠a durante 7 d√≠as diferentes<br>
                            - Cumplir con los t√©rminos de servicio de la plataforma<br>
                            - No haber sido suspendido previamente en eventos similares
                        </div>
                    </div>
                </div>

                <div class="accordion-item">
                    <button class="accordion-trigger" onclick="toggleAccordion(this)">
                        <span>Atenci√≥n y Descargos de Responsabilidad</span>
                        <span class="accordion-icon">‚ñº</span>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            Nos reservamos el derecho de descalificar a cualquier participante que se encuentre haciendo trampa o violando las reglas. Las decisiones del equipo de moderaci√≥n son finales. El contenido inapropiado resultar√° en descalificaci√≥n inmediata.
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-spacer"></div>

        </div>

        <!-- TAB: RANKINGS -->
        <div id="rankings" class="tab-content">
            
            <!-- User Ranking Card -->
            <div class="user-ranking-card" id="user-ranking" style="display: none;">
                <div class="user-rank-position" id="user-position">--</div>
                <div class="user-avatar" id="user-avatar">
                    <span>üë§</span>
                </div>
                <div class="user-info">
                    <div class="user-name">
                        <a href="#" id="user-profile-link" target="_blank"><span id="user-name-display">--</span></a>
                        <span class="verified-badge">‚úì</span>
                    </div>
                    <div class="user-score" id="user-score">0</div>
                </div>
            </div>

            <div class="rankings-header">
                <span>Clasificaciones</span>
                <span class="participant-count">
                    <span>üë§</span>
                    <span id="num-participantes">0</span>
                </span>
            </div>

            <div class="ranking-list" id="ranking-list">
                <div class="ranking-item" style="justify-content: center; padding: 2rem; color: #888;">
                    No hay datos de clasificaci√≥n disponibles
                </div>
            </div>

            <div class="content-spacer"></div>

        </div>

    </div>

    <!-- Botones Fijos -->
    <div class="enter-button-container" id="button-container">
        <button class="btn-enter" id="btn-action" onclick="handleMainAction()">Enter</button>
    </div>

    <!-- Modal de Formulario de Registro -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal">
            <div class="modal-title">√önete al Evento</div>
            <div id="register-error"></div>
            
            <!-- Foto de Perfil -->
            <div class="form-group">
                <label class="form-label">Foto de Perfil (Opcional)</label>
                <div class="image-upload-container" onclick="document.getElementById('reg-image').click()">
                    <input type="file" class="image-upload-input" id="reg-image" accept="image/*" onchange="handleImageUpload(this)">
                    <img class="image-upload-preview" id="image-preview" alt="Preview">
                    <div class="image-upload-text">
                        <span class="icon">üì∑</span>
                        Toca para subir una foto
                    </div>
                    <div class="image-upload-change">Toca para cambiar la foto</div>
                </div>
                <div class="form-hint">Formatos: JPG, PNG. M√°ximo 2MB</div>
            </div>

            <div class="form-group">
                <label class="form-label">Nombre de Usuario *</label>
                <input type="text" class="form-input" id="reg-username" placeholder="Tu nombre de usuario" required>
            </div>

            <div class="form-group">
                <label class="form-label">Correo Electr√≥nico *</label>
                <input type="email" class="form-input" id="reg-email" placeholder="tu@email.com" required>
            </div>

            <div class="form-group">
                <label class="form-label">Link del Perfil *</label>
                <input type="url" class="form-input" id="reg-profile" placeholder="https://estelar.app/usuario" required>
                <div class="form-hint">URL completa de tu perfil en Estelar</div>
            </div>

            <button class="btn-ok-full" onclick="submitRegistration()" id="btn-register">
                Confirmar Registro
            </button>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n de Salida -->
    <div class="modal-overlay" id="leaveModal">
        <div class="modal">
            <div class="modal-title">¬øEst√°s seguro de que deseas salir del evento?</div>
            <p style="color: #666; margin-bottom: 1.5rem; font-size: 0.9rem;">
                Si sales del evento, perder√°s tu progreso y puntuaci√≥n acumulada. Esta acci√≥n no se puede deshacer.
            </p>
            <div class="modal-buttons">
                <button class="btn-modal btn-cancel" onclick="closeModals()">Cancelar</button>
                <button class="btn-modal btn-ok" onclick="confirmLeave()">Salir</button>
            </div>
        </div>
    </div>

    <!-- Modal de √âxito -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-title" id="success-title">¬°Registro Exitoso!</div>
            <p style="color: #666; margin-bottom: 1.5rem;" id="success-message">
                Te has unido al evento correctamente.
            </p>
            <button class="btn-ok-full" onclick="closeModals()">OK</button>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURACI√ìN - TU URL DE GOOGLE APPS SCRIPT
        // ==========================================
        
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzLbkZQu3W1DG0kgScvjsO2eHC7rSpXnyfKB962yhAWVTJMntS3_RIgg7uM5XIUtcbk/exec';
        
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        
        let eventoData = null;
        let fechaFin = null;
        let eventoFinalizado = false;
        let usuarioActual = null;
        let uploadedImageBase64 = null;
        let participantesData = []; // Almacena todos los participantes

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================

        document.addEventListener('DOMContentLoaded', () => {
            const firstAccordion = document.querySelector('.accordion-item.active .accordion-content');
            if (firstAccordion) {
                firstAccordion.style.maxHeight = firstAccordion.scrollHeight + "px";
            }
            
            cargarDatosEvento();
            checkSavedSession();
            cargarParticipantes(); // Cargar participantes al inicio
        });

        // ==========================================
        // CARGAR PARTICIPANTES DESDE GOOGLE SHEETS (JSONP)
        // ==========================================

        function cargarParticipantes() {
            const script = document.createElement('script');
            const callbackName = 'handleParticipants_' + Date.now();
            
            // Crear funci√≥n callback global temporal
            window[callbackName] = function(data) {
                if (data.success && data.participants) {
                    participantesData = data.participants;
                    
                    // Ordenar por puntuaci√≥n
                    participantesData.sort((a, b) => {
                        const scoreA = parseInt(a.score) || 0;
                        const scoreB = parseInt(b.score) || 0;
                        return scoreB - scoreA;
                    });
                    
                    // Actualizar contador
                    document.getElementById('num-participantes').textContent = participantesData.length;
                    
                    // Renderizar rankings
                    renderizarRankings();
                    
                    // Si hay usuario actual, actualizar su posici√≥n
                    if (usuarioActual) {
                        actualizarPosicionUsuario();
                    }
                }
                
                // Limpiar
                delete window[callbackName];
                if (script.parentNode) {
                    document.head.removeChild(script);
                }
            };
            
            // URL con callback
            const url = GOOGLE_SCRIPT_URL + '?action=getParticipants&evento=Create-a-Sticker-Gift&callback=' + callbackName + '&t=' + Date.now();
            
            script.src = url;
            script.onerror = function() {
                console.error('Error cargando participantes');
                cargarParticipantesLocal(); // Fallback
                delete window[callbackName];
                if (script.parentNode) {
                    document.head.removeChild(script);
                }
            };
            
            document.head.appendChild(script);
        }

        function cargarParticipantesLocal() {
            // Cargar desde localStorage como respaldo
            const saved = localStorage.getItem('estelar_participants');
            if (saved) {
                try {
                    participantesData = JSON.parse(saved);
                    document.getElementById('num-participantes').textContent = participantesData.length;
                    renderizarRankings();
                } catch (e) {
                    console.error('Error cargando participantes locales:', e);
                }
            }
        }

        function guardarParticipantesLocal() {
            localStorage.setItem('estelar_participants', JSON.stringify(participantesData));
        }

        function renderizarRankings() {
            const container = document.getElementById('ranking-list');
            
            if (participantesData.length === 0) {
                container.innerHTML = `
                    <div class="ranking-item" style="justify-content: center; padding: 2rem; color: #888;">
                        No hay datos de clasificaci√≥n disponibles
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            participantesData.forEach((participante, index) => {
                const rank = index + 1;
                const rankClass = rank === 1 ? 'rank-1' : rank === 2 ? 'rank-2' : rank === 3 ? 'rank-3' : 'rank-other';
                const rankDisplay = rank <= 3 ? '' : rank;
                
                // Verificar si es el usuario actual
                const esUsuarioActual = usuarioActual && participante.email === usuarioActual.email;
                
                // Si es el usuario actual, no mostrarlo en la lista general (ya tiene su propia tarjeta arriba)
                if (esUsuarioActual) return;
                
                html += `
                    <div class="ranking-item">
                        <div class="rank-number ${rankClass}">${rankDisplay}</div>
                        <div class="rank-avatar">
                            ${participante.profileImage ? 
                                `<img src="${participante.profileImage}" alt="${participante.username}">` : 
                                participante.username.charAt(0).toUpperCase()
                            }
                        </div>
                        <div class="rank-info">
                            <div class="rank-name">
                                <a href="${participante.profileLink || '#'}" target="_blank">${participante.username}</a>
                            </div>
                        </div>
                        <div class="rank-score">${participante.score || 0}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html || `
                <div class="ranking-item" style="justify-content: center; padding: 2rem; color: #888;">
                    No hay otros participantes
                </div>
            `;
        }

        function actualizarPosicionUsuario() {
            if (!usuarioActual) return;
            
            // Encontrar posici√≥n del usuario actual
            const index = participantesData.findIndex(p => p.email === usuarioActual.email);
            if (index !== -1) {
                const posicion = index + 1;
                const positionEl = document.getElementById('user-position');
                
                // Agregar sufijo correcto
                if (posicion === 1) positionEl.textContent = '1st';
                else if (posicion === 2) positionEl.textContent = '2nd';
                else if (posicion === 3) positionEl.textContent = '3rd';
                else positionEl.textContent = posicion + 'th';
            }
        }

        // ==========================================
        // MANEJO DE IM√ÅGENES
        // ==========================================

        function handleImageUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Validar tama√±o (m√°ximo 2MB)
            if (file.size > 2 * 1024 * 1024) {
                showError('La imagen es demasiado grande. M√°ximo 2MB.');
                input.value = '';
                return;
            }
            
            // Validar tipo
            if (!file.type.startsWith('image/')) {
                showError('Por favor selecciona un archivo de imagen v√°lido.');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImageBase64 = e.target.result;
                
                // Mostrar preview
                const preview = document.getElementById('image-preview');
                preview.src = uploadedImageBase64;
                preview.classList.add('active');
                
                // Actualizar UI del contenedor
                const container = document.querySelector('.image-upload-container');
                container.classList.add('has-image');
            };
            reader.readAsDataURL(file);
        }

        // ==========================================
        // CARGA DE DATOS
        // ==========================================

        async function cargarDatosEvento() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/estelarlatam/eventos/main/lista-de-eventos.json');
                const eventos = await response.json();
                
                eventoData = eventos.find(e => e.titulo === "Crear un Regalo de Sticker - Evento Especial");
                
                if (eventoData) {
                    actualizarUI(eventoData);
                }
            } catch (error) {
                console.error('Error cargando datos:', error);
                usarDatosPorDefecto();
            }
        }

        function actualizarUI(data) {
            // No actualizamos el contador aqu√≠, lo hacemos en cargarParticipantes()
            
            const fechaInicio = new Date(data.fecha_inicio);
            const fechaFinEvento = new Date(data.fecha_fin);
            fechaFin = fechaFinEvento;
            
            const ahora = new Date();
            eventoFinalizado = ahora > fechaFinEvento;
            
            if (eventoFinalizado) {
                document.getElementById('countdown').textContent = 'Evento finalizado';
                document.getElementById('countdown').className = 'event-ended';
                updateButtonState();
            } else {
                iniciarCountdown();
            }
            
            const opciones = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit',
                timeZoneName: 'short'
            };
            
            const fechaInicioInscripcion = new Date(fechaInicio);
            fechaInicioInscripcion.setDate(fechaInicioInscripcion.getDate() - 7);
            
            document.getElementById('fecha-inscripcion').textContent = 
                `${fechaInicioInscripcion.toLocaleDateString('es-ES', opciones)} al ${fechaFinEvento.toLocaleDateString('es-ES', opciones)}`;
            
            document.getElementById('fecha-evento').textContent = 
                `${fechaInicio.toLocaleDateString('es-ES', opciones)} al ${fechaFinEvento.toLocaleDateString('es-ES', opciones)}`;
        }

        function usarDatosPorDefecto() {
            // No actualizamos el contador aqu√≠
            
            const fechaInicio = new Date('2026-02-06T12:00:00');
            const fechaFinEvento = new Date('2026-02-08T06:00:00');
            fechaFin = fechaFinEvento;
            
            const ahora = new Date();
            eventoFinalizado = ahora > fechaFinEvento;
            
            document.getElementById('fecha-inscripcion').textContent = 
                '26 de enero de 2026, 18:00 GMT-5 al 8 de febrero de 2026, 06:00 GMT-5';
            
            document.getElementById('fecha-evento').textContent = 
                '6 de febrero de 2026, 12:00 GMT-5 al 8 de febrero de 2026, 06:00 GMT-5';
            
            if (eventoFinalizado) {
                document.getElementById('countdown').textContent = 'Evento finalizado';
                document.getElementById('countdown').className = 'event-ended';
            } else {
                iniciarCountdown();
            }
        }

        // ==========================================
        // COUNTDOWN
        // ==========================================

        function iniciarCountdown() {
            function update() {
                if (!fechaFin) return;
                
                const now = new Date();
                const diff = fechaFin - now;
                
                if (diff > 0) {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    document.getElementById('countdown').textContent = 
                        `${days} d ${hours} h ${minutes} min ${seconds} s`;
                } else {
                    document.getElementById('countdown').textContent = 'Evento finalizado';
                    document.getElementById('countdown').className = 'event-ended';
                    eventoFinalizado = true;
                    updateButtonState();
                }
            }
            
            update();
            setInterval(update, 1000);
        }

        // ==========================================
        // GESTI√ìN DE SESI√ìN
        // ==========================================

        function checkSavedSession() {
            const saved = localStorage.getItem('estelar_event_user');
            if (saved) {
                try {
                    usuarioActual = JSON.parse(saved);
                    if (usuarioActual.evento === 'Create-a-Sticker-Gift') {
                        showEnteredState();
                    }
                } catch (e) {
                    localStorage.removeItem('estelar_event_user');
                }
            }
        }

        function saveSession(data) {
            localStorage.setItem('estelar_event_user', JSON.stringify({
                ...data,
                evento: 'Create-a-Sticker-Gift',
                fechaUnion: new Date().toISOString()
            }));
        }

        function clearSession() {
            localStorage.removeItem('estelar_event_user');
            usuarioActual = null;
        }

        // ==========================================
        // BOTONES Y ACCIONES
        // ==========================================

        function updateButtonState() {
            const btn = document.getElementById('btn-action');
            
            if (eventoFinalizado) {
                btn.textContent = 'Evento Finalizado';
                btn.disabled = true;
                btn.style.opacity = '0.6';
                return;
            }
            
            if (usuarioActual) {
                showEnteredState();
            }
        }

        function showEnteredState() {
            const container = document.getElementById('button-container');
            container.innerHTML = `
                <button class="btn-enter entered" disabled>Entered</button>
                <button class="btn-leave" onclick="showLeaveModal()">Salir</button>
            `;
            
            // Mostrar en rankings con imagen y link
            document.getElementById('user-ranking').style.display = 'flex';
            document.getElementById('user-name-display').textContent = usuarioActual.username || 'Usuario';
            
            // Actualizar link del perfil
            const profileLink = document.getElementById('user-profile-link');
            if (usuarioActual.profileLink) {
                profileLink.href = usuarioActual.profileLink;
            }
            
            // Actualizar imagen si existe
            if (usuarioActual.profileImage) {
                const avatar = document.getElementById('user-avatar');
                avatar.innerHTML = `<img src="${usuarioActual.profileImage}" alt="Avatar">`;
            }
            
            // Actualizar posici√≥n del usuario
            actualizarPosicionUsuario();
        }

        function handleMainAction() {
            if (eventoFinalizado) return;
            if (usuarioActual) return;
            
            // Resetear formulario
            document.getElementById('reg-username').value = '';
            document.getElementById('reg-email').value = '';
            document.getElementById('reg-profile').value = '';
            document.getElementById('reg-image').value = '';
            document.getElementById('image-preview').classList.remove('active');
            document.querySelector('.image-upload-container').classList.remove('has-image');
            uploadedImageBase64 = null;
            
            showRegisterModal();
        }

        // ==========================================
        // MODALES
        // ==========================================

        function showRegisterModal() {
            document.getElementById('registerModal').classList.add('active');
        }

        function showLeaveModal() {
            if (eventoFinalizado) {
                showError('No puedes salir del evento porque ya ha finalizado.');
                return;
            }
            document.getElementById('leaveModal').classList.add('active');
        }

        function closeModals() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.classList.remove('active');
            });
            document.getElementById('register-error').innerHTML = '';
        }

        function showSuccess(title, message) {
            document.getElementById('success-title').textContent = title;
            document.getElementById('success-message').textContent = message;
            document.getElementById('successModal').classList.add('active');
        }

        function showError(message) {
            const errorDiv = document.getElementById('register-error');
            errorDiv.innerHTML = `<div class="alert alert-error">${message}</div>`;
        }

        // ==========================================
        // REGISTRO (UNIRSE AL EVENTO)
        // ==========================================

        async function submitRegistration() {
            const username = document.getElementById('reg-username').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const profile = document.getElementById('reg-profile').value.trim();
            
            if (!username || !email || !profile) {
                showError('Por favor completa todos los campos obligatorios.');
                return;
            }
            
            if (!isValidEmail(email)) {
                showError('Por favor ingresa un correo electr√≥nico v√°lido.');
                return;
            }
            
            if (!isValidURL(profile)) {
                showError('Por favor ingresa una URL v√°lida para tu perfil.');
                return;
            }
            
            const btn = document.getElementById('btn-register');
            const originalText = btn.textContent;
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Procesando...';
            
            try {
                const datos = {
                    action: 'join',
                    evento: 'Create-a-Sticker-Gift',
                    username: username,
                    email: email,
                    profileLink: profile,
                    profileImage: uploadedImageBase64 || '',
                    score: 0,
                    fechaUnion: new Date().toISOString()
                };
                
                // Enviar a Google Apps Script
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(datos)
                });
                
                // Guardar sesi√≥n local
                usuarioActual = datos;
                saveSession(datos);
                
                // Agregar a la lista local y reordenar
                participantesData.push(datos);
                participantesData.sort((a, b) => (b.score || 0) - (a.score || 0));
                guardarParticipantesLocal();
                
                // Actualizar UI
                closeModals();
                showSuccess('¬°Registro Exitoso!', 'Te has unido al evento correctamente. ¬°Buena suerte!');
                showEnteredState();
                renderizarRankings();
                
                // Actualizar contador
                document.getElementById('num-participantes').textContent = participantesData.length;
                
            } catch (error) {
                console.error('Error:', error);
                showError('Hubo un error al procesar tu registro. Por favor intenta de nuevo.');
            } finally {
                btn.disabled = false;
                btn.textContent = originalText;
            }
        }

        // ==========================================
        // SALIR DEL EVENTO
        // ==========================================

        async function confirmLeave() {
            if (eventoFinalizado) {
                showError('No puedes salir del evento porque ya ha finalizado.');
                closeModals();
                return;
            }
            
            if (!usuarioActual) {
                closeModals();
                return;
            }
            
            try {
                const datos = {
                    action: 'leave',
                    evento: 'Create-a-Sticker-Gift',
                    username: usuarioActual.username,
                    email: usuarioActual.email,
                    fechaSalida: new Date().toISOString()
                };
                
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(datos)
                });
                
                // Eliminar de la lista local
                participantesData = participantesData.filter(p => p.email !== usuarioActual.email);
                guardarParticipantesLocal();
                
                clearSession();
                
                const container = document.getElementById('button-container');
                container.innerHTML = '<button class="btn-enter" id="btn-action" onclick="handleMainAction()">Enter</button>';
                
                document.getElementById('user-ranking').style.display = 'none';
                
                // Actualizar contador
                document.getElementById('num-participantes').textContent = participantesData.length;
                
                // Re-renderizar rankings
                renderizarRankings();
                
                closeModals();
                showSuccess('Salida Exitosa', 'Has salido del evento correctamente.');
                
            } catch (error) {
                console.error('Error:', error);
                showError('Hubo un error al procesar tu solicitud.');
            }
        }

        // ==========================================
        // UTILIDADES
        // ==========================================

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleAccordion(trigger) {
            const item = trigger.parentElement;
            const isActive = item.classList.contains('active');
            
            document.querySelectorAll('.accordion-item').forEach(acc => {
                acc.classList.remove('active');
                acc.querySelector('.accordion-content').style.maxHeight = null;
            });
            
            if (!isActive) {
                item.classList.add('active');
                const content = item.querySelector('.accordion-content');
                content.style.maxHeight = content.scrollHeight + "px";
            }
        }

        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay && !overlay.id.includes('success')) {
                    closeModals();
                }
            });
        });

        // Recargar participantes cada 30 segundos para mantener actualizado
        setInterval(cargarParticipantes, 30000);
    </script>

</body>
</html>
